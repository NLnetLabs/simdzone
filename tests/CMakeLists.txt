find_package(cmocka)
if(NOT cmocka_found)
  message(STATUS "cmocka was not found on the system.")
  message(STATUS "Importing and building cmocka from source.")
  include(${PROJECT_SOURCE_DIR}/cmake/import.cmake)
  import_dependency(cmocka clibs/cmocka  f5e2cd7)
  set(BUILD_STATIC_LIB ON)
  set(WITH_EXAMPLES OFF CACHE STRING "Include cmake examples."  FORCE)
  add_dependency(cmocka)
  add_library(cmocka::cmocka ALIAS cmocka-static)
  message(STATUS "cmocka was built.")
endif()
cmocka_add_tests(zone-tests types.c include.c)

target_link_libraries(zone-tests PRIVATE zone)
if(CMAKE_C_COMPILER_ID MATCHES "Clang")
  target_compile_options(zone-tests PRIVATE -Wno-missing-prototypes -Wno-deprecated-declarations)
elseif(CMAKE_C_COMPILER_ID STREQUAL "GNU")
  target_compile_options(zone-tests PRIVATE -Wno-missing-prototypes)
endif()
